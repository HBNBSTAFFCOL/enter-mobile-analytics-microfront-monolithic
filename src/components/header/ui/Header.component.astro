---
import Button from "../../button/ui/Button.component.astro";
---

<header class="header">
    <figure class="header__icon">
        <img
            class="header__icon-image"
            src="/images_Enter/logoEnter.png"
            alt=""
        />
    </figure>
    <section class="header__search-section">
        <Button
            type="fake-input"
            id="button-fake-input"
            icon="/search-svgrepo-com.svg"
            text="Buscar"
        />
    </section>

    <section class="search header__search-real" id="search-container">
        <input
            type="text"
            name=""
            class="search__serachbar-input"
            id="filters__search-input"
            placeholder="Buscar"
        />

        <figure class="search__serachbar-icon">
            <img
                class="search__serachbar-icon-image"
                src="/search-svgrepo-com.svg"
                alt=""
            />
        </figure>
    </section>
    <section class="filters header__filters" id="filters-container">
        <nav class="filters__navigation">
            <Button
                type="filters-navigation"
                id="button-filters-navigation-camara"
                icon=""
                text="Camara"
                detail="Selfie 100 MPX / Main Camara 200 MPX"
            />
            <Button
                type="filters-navigation"
                id="button-filters-navigation-battery"
                icon=""
                text="Bateria"
                detail="1000 MHP"
            />
            <Button
                type="filters-navigation"
                id="button-filters-navigation-screen"
                icon=""
                text="Pantalla"
                detail="7 Pulgadas"
            />
            <Button
                type="filters-navigation"
                id="button-filters-navigation-memory"
                icon=""
                text="Memoria"
                detail="8 RAM / 256 GB ALMACENAMIENTO"
            />
        </nav>
        <section class="filters__modal">
            <article class="filters__camara-modal" id="camara-modal">
                <section>
                    <h3>Selfie MPX Range</h3>
                    <label for="filters__camara--mpx-range"></label>
                    <input
                        type="range"
                        id="filters__camara--mpx-range"
                        name="mpxRange"
                        min="2"
                        max="150"
                        step="1"
                        value="50"
                    />
                </section>

                <section>
                    <h3>Principal MPX Range</h3>
                    <label for="filters__camara--mpx-range"></label>
                    <input
                        type="range"
                        id="filters__camara--mpx-range"
                        name="mpxRange"
                        min="2"
                        max="300"
                        step="1"
                        value="50"
                    />
                </section>
            </article>

            <article class="filters__battery-modal" id="battery-modal">
                <section>
                    <h3>Bateria</h3>
                    <label for="filters__battery--mAh-range"></label>
                    <input
                        type="range"
                        id="filters__battery--mAh-range"
                        name="mAhRange"
                        min="2"
                        max="150"
                        step="1"
                        value="50"
                    />
                </section>
            </article>

            <article class="filters__screen-modal" id="screen-modal">
                <section>
                    <h3>Pantalla</h3>
                    <label for="filters__screen--inches-range"></label>
                    <input
                        type="range"
                        id="filters__screen--inches-range"
                        name="inchesRange"
                        min="2"
                        max="150"
                        step="1"
                        value="50"
                    />
                </section>
            </article>

            <article class="filters__memory-modal" id="memory-modal">
                <section>
                    <h3 title="Pa que sea rapidito">Memoria RAM</h3>
                    <label for="filters__memory--gb-range"></label>
                    <input
                        type="range"
                        id="filters__memory--gb-range"
                        name="gbRange"
                        min="2"
                        max="150"
                        step="1"
                        value="50"
                    />
                </section>

                <section>
                    <h3>Almacenamiento</h3>
                    <input
                        type="text"
                        name=""
                        id=""
                        list="almacenaminto-list"
                    />
                    <datalist id="almacenaminto-list">
                        <option value="MB"></option>
                        <option value="GB"></option>
                        <option value="TB"></option>
                    </datalist>
                    <label for="filters__memory--gb-range"></label>
                    <input
                        type="range"
                        id="filters__memory--gb-range"
                        name="gbRange"
                        min="2"
                        max="300"
                        step="1"
                        value="50"
                    />
                </section>
            </article>
        </section>
    </section>
    <button class="bubble header__bubble-comparation">
        <span class="bubble__counter">3</span>

        <figure class="bubble__stock">
            <img class="bubble__stock-image" src="" alt="" />
        </figure>
        <figure class="bubble__icon">
            <img class="bubble__icon-image" src="" alt="" />
        </figure>
    </button>
</header>

<script>
  const DOMService = {
    listenerDocumentClick(event: MouseEvent) {
      const $filtersContainer = document.getElementById("filters-container");
      const $searchButton = document.getElementById("button-fake-input");
      const $searchContainer = document.getElementById("search-container");
  
      if (!($filtersContainer instanceof HTMLElement) || !($searchButton instanceof HTMLElement) || !($searchContainer instanceof HTMLElement)) return;
  
      const targetElement = event.target as HTMLElement;
  
      // Verifica si el clic ocurrió fuera del contenedor de filtros y si los filtros están visibles
      if (!targetElement.closest("#filters-container") && $filtersContainer.classList.contains("show-filters")) {
        $filtersContainer.classList.remove("show-filters");
        $searchButton.classList.remove("hidden-button-fake-search");
        $searchContainer.classList.remove("show-button-search");
  
        // Elimina el manejador de clic al documento cuando el menú de filtros está inactivo
        document.removeEventListener("click", DOMService.listenerDocumentClick);
      }
    },
  
    listenerSearchButtonActive() {
      const $searchButton = document.getElementById("button-fake-input");
      const $filtersContainer = document.getElementById("filters-container");
      const $searchContainer = document.getElementById("search-container");
  
      if (!($searchButton instanceof HTMLElement) || !($filtersContainer instanceof HTMLElement) || !($searchContainer instanceof HTMLElement)) return;
  
      $searchButton.addEventListener("click", (event) => {
        event.stopPropagation(); // Evita que el clic llegue al documento y active listenerDocumentClick
        $searchButton.classList.add("hidden-button-fake-search");
        $filtersContainer.classList.add("show-filters");
        $searchContainer.classList.add("show-button-search");
        $searchContainer.querySelector("input")?.focus();
  
        // Agrega el manejador de clic al documento cuando se muestra el menú de filtros
        document.addEventListener("click", DOMService.listenerDocumentClick);
      });
  
      // Verifica el llamado a listenersSearchButtonInactive al desmontar el componente
      window.addEventListener("beforeunload", () => {
        document.removeEventListener("click", DOMService.listenerDocumentClick);
      });
    },
  };
  
  window.addEventListener("DOMContentLoaded", () => {
    DOMService.listenerSearchButtonActive();
  });
  </script>
  
  
<style>
    .header {
        background-color: var(--color-brand--secondary);
        width: 100%;
        height: 100px;
        box-shadow: inset 0px -5px 0px 0px var(--color-brand--primary);
        display: grid;
        grid-template-columns: 150px 1fr 150px;
        grid-template-rows: 100px 60px 300px;
        gap: 1rem;
        position: relative;
        align-items: center;
    }

    .header__icon {
        grid-column: 1 / 2;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .header__search-section {
        grid-column: 2 / 3;
        grid-row: 1 / 2;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .header__search-real {
        grid-column: 2 / 3;
        grid-row: 1 / 2;
        background-color: transparent;
        color: var(--color-brand--text);
        background-color: aliceblue;
        border: none;
        cursor: pointer;
        width: 100%;
        height: 2rem;
        border-radius: 1rem;
        display: none;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        box-sizing: border-box;
        flex-direction: row;
    }

    .search__serachbar-input {
        margin: unset;
        padding: unset;
        line-height: 1rem;
        width: calc(100% - 2rem);
        background-color: transparent;
    }

    .search__serachbar-icon {
        background-color: var(--color-action--success);
        width: 2rem;
        height: 2rem;
        display: grid;
        place-items: center;
        border-radius: 50%;
        position: relative;
        right: -1rem;
    }

    .search__serachbar-icon img {
        width: 50%;
        filter: invert(1);
    }

    .button--fake-input:hover {
    }

    .header__bubble-comparation {
        grid-column: 3 / 4;
        grid-row: 1 / 2;
    }

    .header__filters {
        grid-column: 2 / 3;
        grid-row: 3 / 4;
    }

    #filters-container {
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        position: fixed;
        left: 50%;
        top: 60px; /* Ajusta la posición según la altura de tu barra de búsqueda */
        right: 10px; /* Ajusta la posición según la posición deseada */
        padding: 15px;
        display: none;
        z-index: 2; /* Asegura que esté por encima de otros elementos */
        width: 80%; /* Ajusta el ancho según tus necesidades */
        max-width: 400px; /* Asegura que no sea más ancho que la pantalla */
        box-sizing: border-box;
        
  }

    #filters-container.show-filters {
        display: block;
    }

    .filters__modal {
        grid-column: 2 / 3;
        grid-row: 3 / 4;
        display: grid;
       
    }

    .filters__modal article {
        background-color: #f8f8f8;
        padding: 15px;
        border-radius: 8px;
    }

    .filters__modal h3 {
        margin-bottom: 10px;
        font-size: 18px; /* Ajusta el tamaño de la fuente según tus necesidades */
    }

    .filters__modal input[type="range"] {
        width: 100%;
  }

    .filters__navigation {
        display: flex;
        gap: 10px; /* Espacio entre los botones */
    }

    .search-visible {
        display: grid;
    }

    .search--show {
        display: none;
    }

    .header__icon-image {
        width: 170px;
        max-width: unset;
        margin-left: 1rem;
    }





</style>



<style is:global>

    .hidden-button-fake-search { 
        display: none !important;
    }

    .show-button-search {
        display: flex !important;

    }
</style>
